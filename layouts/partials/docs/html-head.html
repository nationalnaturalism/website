{{ $styles := resources.Get "css/main.css" | minify }}
<link rel="preload" href="{{(resources.Get "/fonts/norse.woff2").RelPermalink}}" as="font" type="font/woff2" crossOrigin>
<link rel="stylesheet" href="{{ $styles.RelPermalink }}" type="text/css">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<meta name="theme-color" content="black">
<meta name="color-scheme" content="dark">
<link rel="preload" as="image" href="{{(resources.Get .Site.Params.brand).RelPermalink}}" type="image/webp">
{{.Page.Store.Set "preload-list" (slice dict) }}
{{ $fuzzy := .FuzzyWordCount }}
{{range (after 1 (uniq ($.Page.Store.Get "preload-list")))  }}
<link rel="preload" as="image" href="{{ .url }}" imagesrcset="{{.srcset}}" imagesizes="{{.sizes}}">
{{ end }}
{{ $breakpointvalue := "600px" }}
{{- if default true .Site.Params.BookServiceWorker -}}
  {{- $swJS := resources.Get "sw-register.js" | resources.ExecuteAsTemplate "sw.js" . | resources.Minify | resources.Fingerprint }}
<script type="text/javascript" src="{{ $swJS.RelPermalink }}" {{ template "integrity" $swJS }} defer></script>
{{ end -}}
{{ with .Keywords }}<meta name="keywords" content="{{delimit . " "}}">{{- end -}}
{{- with .Page.Params.BookHref -}}<meta http-equiv="Refresh" content="0; url='{{ . }}'">{{- end -}}
<title>{{ .LinkTitle|.RenderString|plainify }} | {{ .Site.Title }}</title>
{{- $manifest := resources.Get "manifest.json" | resources.ExecuteAsTemplate "manifest.json" . }}
<link rel="manifest" href="{{ $manifest.RelPermalink }}">
{{- range .Translations }}
<link rel="alternate" hreflang="{{ default .Language.Lang site.LanguageCode }}" href="{{ .RelPermalink }}" title="{{ partial "docs/title" . }}">
{{- end -}}
<meta name="twitter:site" content="@{{ .Site.Params.twitter }}"/>
<meta name="twitter:title" content="{{ .Title }}"/>
{{ with plainify (.RenderString (default site.Params.description .Description)) }}
	<meta name="description" content="{{ . }}">
	<meta name="twitter:description" content="{{.}}"/>
	<meta property="og:description" content="{{.}}"/>
{{end}}
{{- with .Page.Params.images -}}
	{{ $resource := resources.Get (index . 0)}}
	{{- $32h := "" -}}
	{{- $110h := "" -}}
	{{ if gt $resource.Height 110 }}
		{{ $110h = $resource.Resize "x110" }}
	{{ else }}
		{{ $110h = $resource }}
	{{ end }}
	{{ if gt $resource.Height 32 }}
		{{ $32h = $resource.Resize "x32" }}
	{{ else }}
		{{ $32h = $resource }}
	{{ end }}
	<meta name="twitter:card" content="summary_large_image"/>
	<meta name="twitter:image" content="{{(default $resource (resources.Get site.Params.brand)).RelPermalink}}"/>
	<style type="text/css">@layer base {
	article header {
	--header-background-image-large: url({{$110h.RelPermalink}});
	--header-background-image-small: url({{$32h.RelPermalink}});}
	}
	</style>
	<link rel="preload" as="image" href="{{$110h.RelPermalink}}" type="image/webp" media="(width>{{$breakpointvalue}})">
	<link rel="preload" as="image" href="{{$32h.RelPermalink}}}" type="image/webp" media="(width<={{$breakpointvalue}})">
	<meta property="og:image" content="{{$resource.RelPermalink}}" />
	<meta property="og:image:type" content="{{$resource.MediaType.Type}}" />
	<meta property="og:image:width" content="{{$resource.Width}}" />
	<meta property="og:image:height" content="{{$resource.Height}}" />
{{- end -}}
{{- define "integrity" -}}
  {{- if (urls.Parse .RelPermalink).Host -}}
    integrity="{{ .Data.Integrity }}"
  {{- end -}}
{{- end -}}
<meta property="og:title" content="{{ .Title }}"/>
<meta property="og:site_name" content="{{site.Title}}">
<meta property="og:type" content="{{ if .IsHome }}website{{ else }}article{{ end }}"/>
<meta property="og:url" content="{{ .RelPermalink }}"/>
{{- if .IsPage }}
	<meta property="article:section" content="{{ .Section }}" />
	<meta property="article:modified_time" content="{{.Lastmod.Format  "Monday, 02/01/2006"}}" />
{{ end }}
{{- with .Params.audio }}
	<meta property="og:audio" content="{{ . }}" />
{{ end }}
{{- range .Params.videos }}
	<meta property="og:video" content="{{ . | absURL }}" />
{{ end }}
{{ range first 3 (where (site.RegularPages.Related .) "Params.bookSearchExclude" false ) }}
	<meta property="og:see_also" content="{{ .RelPermalink }}" />
{{ end }}
{{- with .Site.Social.facebook_admin }}
	<meta property="fb:admins" content="{{ . }}" />
{{ end }}
